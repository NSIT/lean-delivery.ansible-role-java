---
- name: Perform install from repositories
  block:
    # Amazon Corretto 8 specific
    # Installing on Amazon Linux 2 from repo
    # https://docs.aws.amazon.com/corretto/latest/corretto-8-ug/amazon-linux-install.html
    # As we cannot use amazon-linux-extras with Ansible, we're adding Amazon corretto8 repo manually
    - name: Add Amazon yum repository for corretto8
      yum_repository:
        name: amazon-corretto8
        description: Amazon Extras repo for corretto8
        mirrorlist: http://amazonlinux.$awsregion.$awsdomain/$releasever/extras/corretto8/latest/$basearch/mirror.list
        priority: 10
      when:
        - ansible_distribution == "Amazon"
        - ansible_distribution_version == "2"
        - java_major_version|int == 8

    - name: 'Perform repo install'
      include_tasks: '{{ install_task }}'
      with_first_found:
        - 'install/{{ ansible_os_family }}_{{ java_distribution }}.yml'
        - 'install/{{ ansible_os_family }}.yml'
      loop_control:
        loop_var: install_task

    - name: Finalize binary paths
      include_tasks: finalize_paths.yml
  become: true
